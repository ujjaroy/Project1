trigger:
  branches:
    include:
      - main

variables:
  azure: 'https://ujjalkrroy0295@dev.azure.com/ujjalkrroy0295/MyProject/_git/AZ_Repo'
  git: 'https://github.com/UjjalKrRoy/AZ_Repo.git'

pr:
  branches:
    include:
      - '*'

pool:
  name: 'Self Pool'

steps:
- checkout: self

- script: |
    rd /S /Q "D:\AzureDevops\AZ_Git\ClonedRepo"
    del /S /Q "D:\AzureDevops\AZ_Git\ClonedRepo\*"
    git config --global credential.helper manager-core
    git clone https://github.com/UjjalKrRoy/AZ_Repo.git D:\AzureDevops\AZ_Git\ClonedRepo
  displayName: 'Pull code from GitHub'

- script: |
    cd "D:\AzureDevops\AZ_Git\ClonedRepo"
    git remote rm origin
  displayName: 'CD & Remove Previous Origin'
    
- script: |
    git remote add origin https://ujjalkrroy0295@dev.azure.com/ujjalkrroy0295/MyProject/_git/My_Repo
    git config user.email "ujjalkrroy@hotmail.com"
    git remote -v
    git -c http.extraheader="AUTHORIZATION: bearer $(System.AccessToken)" push -u origin --all
  displayName: 'Push to Azure DevOps'

- task: CmdLine@2
  inputs:
    script: 'cd D:\AzureDevops\AZ_Git\ClonedRepo'

- task: CmdLine@2
  inputs:
    script: 'git push -u origin --all'